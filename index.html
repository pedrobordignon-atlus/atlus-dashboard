<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Atlus Dashboards</title>

  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="assets/css/styles.css">

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">
      <img src="Atlus_logo_files/favicon.png" alt="Atlus" width="40" height="40" onerror="this.src='favicon.png';">
    </div>
    <div class="title" id="headerTitle">Atlus Dashboards</div>
  </div>
  <div style="display:flex; align-items:center; gap:8px">
    <button class="btn link if-guest" id="openAdminLogin">Admin</button>
    <button class="btn link if-admin" id="logoutBtn">Logout</button>
    <button class="btn link if-admin" id="openFeedbackList">Feedback</button> <!-- NOVO -->
    <div class="muted" id="lastUpdated">Last updated: ‚Äî</div>
  </div>
</header>

<!-- Admin login lightbox -->
<div id="adminLoginBox">
  <div id="adminLoginCard">
    <div style="font-weight:700">Admin login</div>
    <input id="adminPassword" class="input" type="password" placeholder="Password" />
    <div style="display:flex; gap:8px; justify-content:flex-end">
      <button class="btn link" id="cancelAdminLogin">Cancel</button>
      <button class="btn primary" id="confirmAdminLogin">Enter</button>
    </div>
    <div class="muted" id="adminLoginMsg"></div>
  </div>
</div>

<main class="container">
  <!-- HOME -->
  <section id="view-home" class="stack" style="display:none">
 <div class="hero">
  <h1 style="margin:0">Welcome to <span style="color:#dbeafe">Atlus Dashboards</span></h1>
  <div class="muted">Choose a dashboard below. You can come back here anytime.</div>
</div>

<!-- Bot√£o para abrir o modal de feedback -->
<div style="text-align:center; margin:18px 0 8px;">
  <button class="btn primary" onclick="openFeedbackModal()">üí¨ Give Feedback</button>
</div>

  <div class="cards">
    <div class="card">
      <div class="pill">Featured</div>
      <h3 style="margin:2px 0 0">Atlus Performance Dashboard</h3>
      <div class="muted">Leads, Spend, ROI, Profit + performance KPIs for LSA & Thumbtack.</div>
      <div><button class="btn" onclick="openView('atlus')">Open</button></div>
    </div>

      <div class="card">
        <div class="pill">New</div>
        <h3 style="margin:2px 0 0">Bonus & Tech Dashboard (BRAVO)</h3>
        <div class="muted">Bonus by tech and status for CURRENT PAY PERIOD</div>
        <div><button class="btn" onclick="openView('bonus')">Open</button></div>
      </div>

      <div class="card">
        <div class="pill">New</div>
        <h3 style="margin:2px 0 0">Annual Recurring Value (ARV) + Subscriptions</h3>
        <div class="muted">Performance for the current month.</div>
        <div><button class="btn" onclick="openView('subs')">Open</button></div>
      </div>

      <div class="card" style="align-content:start">
        <div class="pill">Future dashboard</div>
        <h3 style="margin:2px 0 0">Coming soon</h3>
        <div><button class="btn link" disabled>Soon</button></div>
      </div>
    </div>
  </section>

  <!-- ATLUS -->
  <section id="view-atlus" class="stack" style="display:none">
    <div class="backRow"><button class="btn link" onclick="openView('home')">‚Üê Back to Home</button></div>

    <div class="panel">
      <div class="noteTitle">üëã Hello, Atlus coworker, glad to see you here!</div>
      <div class="note">
        This dashboard shows leads from the platforms we currently pay for:
        <b>LSAs + Thumbtack</b>.<br>
        <b>Important:</b> <i>Thumbtack spend is paid at the company level (Atlus overall)</i>, so its
        <b>locations</b> will appear as <b>‚ÄúAll locations‚Äù</b> by design.
      </div>

      <div class="note" style="margin-top:8px">
        <b>Tip:</b> If you don‚Äôt see the data yet, click
        <a href="#" onclick="loadFromUrl(document.getElementById('csvUrl').value); return false;"><u>Reload</u></a>
        to load it.
      </div>
    </div>

    <!-- Filters -->
    <div class="panel filters">
      <div><label class="muted">Month / Year</label><select id="monthFilter"></select></div>
      <div><label class="muted">Location</label><select id="locationFilter"></select></div>
      <div><label class="muted">Platform</label><select id="platformFilter"></select></div>
      <div style="display:grid;align-content:end"><button class="btn" id="clearFilters">Clear</button></div>
    </div>

    <!-- KPIs -->
    <div class="kpis">
      <div class="kpi"><div class="label">Leads</div><div class="value"><span class="dot blue"></span><span id="kpiLeads">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Spend</div><div class="value"><span class="dot blue"></span><span id="kpiSpend">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Closed Jobs</div><div class="value"><span class="dot gold"></span><span id="kpiJobs">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Contract Total</div><div class="value"><span class="dot gold"></span><span id="kpiContract">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Profit</div><div class="value"><span class="dot green"></span><span id="kpiProfit">‚Äî</span></div></div>
      <div class="kpi"><div class="label">ROI</div><div class="value"><span class="dot green"></span><span id="kpiROI">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Approx. Daily Spend</div><div class="value"><span class="dot blue"></span><span id="kpiDaily">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Close Rate</div><div class="value"><span class="dot gold"></span><span id="kpiClose">‚Äî</span></div></div>
      <div class="kpi"><div class="label">% Good Leads</div><div class="value"><span class="dot green"></span><span id="kpiGood">‚Äî</span></div></div>
    </div>

    <!-- Charts -->
    <div class="grid-2">
      <div class="panel chart-360"><div style="margin-bottom:8px;font-weight:700">Leads per Platform</div><canvas id="chartLeads"></canvas></div>
      <div class="panel chart-360"><div style="margin-bottom:8px;font-weight:700">ROI per Location</div><canvas id="chartROI"></canvas></div>
    </div>
    <div class="panel chart-420"><div style="margin-bottom:8px;font-weight:700">Profit per Location</div><canvas id="chartProfit"></canvas></div>

    <!-- Data source (bottom) -->
    <div class="panel admin-only">
      <div class="row">
        <div><label class="muted">Live CSV link</label><input id="csvUrl" class="input" placeholder="https://docs.google.com/.../output=csv"></div>
        <div style="max-width:300px"><label class="muted">or CSV upload</label><input id="csvFile" type="file" class="input" accept=".csv"></div>
        <div style="max-width:160px"><label class="muted">&nbsp;</label><button id="reloadAtlus" class="btn primary">Reload</button></div>
        <div style="max-width:220px"><label class="muted">&nbsp;</label><label class="muted" style="display:flex;gap:8px;align-items:center"><input id="autoRefresh" type="checkbox" checked> Live (auto-refresh 5 min)</label></div>
      </div>
      <div id="statusChips" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap"></div>
    </div>
  </section>

  <!-- BONUS & TECH -->
  <section id="view-bonus" class="stack" style="display:none">
    <div class="backRow"><button class="btn link" onclick="openView('home')">‚Üê Back to Home</button></div>

    <div class="panel">
  <div class="noteTitle">üß∞ Bonus & Tech Dashboard (<span id="btSheetName">Current pay period</span>)</div>
<div class="note">
  This panel reads <b>only the active sheet</b> using the (<span id="btSheetName2">Current pay period</span>).
</div>


    <div class="panel if-guest">
      <div class="muted">Want to refresh the data? Click
        <a href="#" id="btReloadPublic" style="color:#dbeafe;text-decoration:underline">Reload</a>.
      </div>
    </div>

    <div class="panel filters">
      <div><label class="muted">Tech / Owner</label><select id="btOwner"></select></div>
      <div><label class="muted">Status</label>
        <select id="btStatus"><option value="">All status</option><option value="Completed">Completed</option><option value="Pending">Pending</option></select>
      </div>
      <div><label class="muted">Job (contains)</label><input id="btJobSearch" class="input" placeholder="e.g., Trelona, Bed Bug..."></div>
      <div style="display:grid;align-content:end;gap:8px"><button class="btn" id="btClear">Clear</button></div>
    </div>

    <div class="kpis">
      <div class="kpi"><div class="label">Jobs</div><div class="value"><span class="dot blue"></span><span id="btJobs">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Completed</div><div class="value"><span class="dot green"></span><span id="btCompleted">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Pending</div><div class="value"><span class="dot gold"></span><span id="btPending">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Contract Total</div><div class="value"><span class="dot blue"></span><span id="btContractTotal">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Bonus Total</div><div class="value"><span class="dot green"></span><span id="btBonusTotal">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Avg Bonus / Job</div><div class="value"><span class="dot gold"></span><span id="btAvgBonus">‚Äî</span></div></div>
    </div>

    <div class="panel admin-only">
      <div class="row">
        <div><label class="muted">Guide CSV link (active sheet)</label><input id="btCsvUrl" class="input" placeholder="https://docs.google.com/.../output=csv"></div>
        <div style="max-width:160px"><label class="muted">&nbsp;</label><button id="btReload" class="btn primary">Reload</button></div>
      </div>
      <div id="btStatusChips" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap"></div>
    </div>

    <div class="panel">
      <div style="margin-bottom:8px;font-weight:700">Jobs</div>
      <div id="btTable" style="display:grid;gap:8px"></div>
    </div>
  </section>

  <!-- SUBSCRIPTIONS / ARV -->
  <section id="view-subs" class="stack" style="display:none">
    <div class="backRow"><button class="btn link" onclick="openView('home')">‚Üê Back to Home</button></div>

    <div class="panel">
      <div class="noteTitle">üìÑ Subscriptions / ARV</div>
      <div class="note" id="svcCycleNote">Loading cycle‚Ä¶</div>
      <div class="note" style="margin-top:8px">
        <b>Supported columns:</b>
        Customer ID, Customer, Subscription, Active, Sales Rep, Date Sold, Initial Service Date, Status, Balance, ARV.
      </div>
    </div>

    <div class="panel if-guest">
      <div class="muted">Need to refresh the data? Click
        <a href="#" id="svcReloadPublic" style="color:#dbeafe;text-decoration:underline">Reload</a>.
      </div>
    </div>

    <div class="panel admin-only">
      <div class="row">
        <div><label class="muted">Subscriptions CSV link</label>
          <input id="svcCsvUrl" class="input" placeholder="https://docs.google.com/.../output=csv">
        </div>
        <div style="max-width:160px"><label class="muted">&nbsp;</label>
          <button id="svcReload" class="btn primary">Reload</button></div>
      </div>
    </div>

    <div class="kpis">
      <div class="kpi"><div class="label">Subscriptions</div><div class="value"><span class="dot blue"></span><span id="svcKpiCount">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Active</div><div class="value"><span class="dot green"></span><span id="svcKpiActive">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Total ARV</div><div class="value"><span class="dot gold"></span><span id="svcKpiARV">‚Äî</span></div></div>
      <div class="kpi"><div class="label">Total Balance</div><div class="value"><span class="dot blue"></span><span id="svcKpiBalance">‚Äî</span></div></div>
    </div>

    <div class="stack-charts">
      <div class="panel chart-340"><div style="margin-bottom:8px;font-weight:700">Active vs Inactive</div><canvas id="svcChartActive"></canvas></div>
      <div class="panel chart-420"><div style="margin-bottom:8px;font-weight:700">Top Plans (by # of subscriptions)</div><canvas id="svcChartPlans"></canvas></div>
      <div class="panel chart-360"><div style="margin-bottom:8px;font-weight:700">ARV per Sales Rep</div><canvas id="svcChartArvByRep"></canvas></div>
      <div class="panel chart-360"><div style="margin-bottom:8px;font-weight:700"># Subscriptions per Sales Rep</div><canvas id="svcChartCountByRep"></canvas></div>
    </div>

    <div class="panel" style="display:none">
      <div style="margin-bottom:8px;font-weight:700">Subscriptions</div>
      <div id="svcTable" style="display:grid;gap:8px"></div>
    </div>
  </section>
<!-- Feedback Modal (sem email) -->
<div id="feedbackBox" style="position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.45);z-index:1000;">
  <div class="panel" style="width:680px;max-width:95vw;border-radius:16px;padding:16px;display:grid;gap:12px;background:var(--panel);border:1px solid var(--border);">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div style="font-weight:700">Send Feedback</div>
      <button id="fbClose" class="btn link" style="padding:6px 10px">‚úï</button>
    </div>

    <label>Your name (optional)</label>
    <input id="fbName" class="input" placeholder="Your name">

    <label>Rate your experience</label>
    <select id="fbRating" class="input">
      <option>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
      <option>‚≠ê‚≠ê‚≠ê‚≠ê Good</option>
      <option>‚≠ê‚≠ê‚≠ê Okay</option>
      <option>‚≠ê‚≠ê Needs improvement</option>
      <option>‚≠ê Poor</option>
    </select>

    <label>Message</label>
    <textarea id="fbMessage" class="input" rows="6" placeholder="Tell us what you think‚Ä¶"></textarea>

    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn link" id="fbCancel">Cancel</button>
      <button class="btn primary" id="fbSend">Send</button>
    </div>
  </div>
</div>
<!-- Feedback List (Admin only) -->
<div id="feedbackListBox" style="position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.45);z-index:1000;">
  <div class="panel" style="width:880px;max-width:96vw;max-height:90vh;overflow:auto;border-radius:16px;padding:16px;display:grid;gap:12px;background:var(--panel);border:1px solid var(--border);">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
      <div style="font-weight:700">Feedback (admin)</div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="fbExport">Export CSV</button>
        <button class="btn link" id="fbClearAll" title="Delete all">Clear</button>
        <button class="btn link" id="fbListClose">‚úï</button>
      </div>
    </div>
    <div id="fbList" style="display:grid;gap:10px"></div>
  </div>
</div>
</main>

<!-- App scripts -->
<script src="assets/js/common.js"></script>
<script src="assets/js/router.js"></script>
<script src="assets/js/atlus.js"></script>
<script src="assets/js/bonus.js"></script>
<script src="assets/js/subs.js"></script>
</body>
</html>
